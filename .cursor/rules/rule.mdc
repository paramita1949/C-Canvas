---
alwaysApply: true
---
始终使用中文回答问题
不能随意生成MD文档，除非有明确要求
禁止自动GIT存档，除非有明确要求
GIT存档推送的时候，说明要求用中文，不要用英文。同时要注意中文的编码，防止乱码
代码逻辑必须保持最简单有效的思路来编写
如果用户发现代码测试错误，首先要做的就是添加调试信息，来定位问题，而不是乱猜问题原因
调试信息，需要加上IF DEBUG来控制是否输出


经验教训
在WPF开发中：
依赖属性必须显式设置，不能依赖默认值或之前的状态
不同功能共享同一个UI控件时，每次使用都要完整初始化所有相关属性
特别是 Stretch、HorizontalAlignment、VerticalAlignment、Margin 等布局属性

经验教训
规则：在 WPF 开发中，需要渲染 Canvas 的子元素时：
❌ 不要直接对子元素调用 Arrange()，这会破坏 Canvas 的位置控制
✅ 应该使用 VisualBrush 创建视觉副本，对副本进行操作
✅ 或者把子元素临时从 Canvas 移除，渲染后再放回

## C#/WPF迁移重要注意事项
遇到功能问题时，必须先做以下检查：
1. 先查看Canvas文件夹中的Python参考实现，理解原始逻辑
2. 不要臆测或添加额外的"优化"逻辑（如快速点击检测等）
3. 调试信息必须显示具体的判断条件值，而不是只输出结果
4. 理解WPF框架特性：
   - Storyboard.Stop()后必须用BeginAnimation(property, null)清除动画属性
   - 依赖属性会被动画"霸占"，直到显式清除
   - Console.WriteLine输出的位置和System.Diagnostics.Debug.WriteLine不同
5. 遇到动画、滚动等涉及UI的问题，优先检查属性是否被动画占用

添加IF DEBUG调试信息的时候，要注意 声明了变量“ex”，但从未使用过这个问题，正式编译会出现这个警告。