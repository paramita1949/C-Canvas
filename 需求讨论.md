1、关键帧录制完成后，脚本的时间，有一个总时间。第一帧-最后第一帧
2、目前功能是每个帧的播放时间。

现在新增一个功能，根据总时间，比如总共录制了50秒，然后根据这50秒+滚动函数，持续的滚动，然后循环。
新增一个合成时间播放功能。

1、首先合成播放按钮设计在哪里，菜单栏按钮
2、图片区域，当有录制数据，自动会弹出一个合成播放的按钮
3、右键菜单，添加合成播放功能

---

## ✅ 功能已实现（2025-10-21）

### 实现内容

**合成播放功能：**
- 根据所有关键帧的总时长，从第一帧平滑滚动到最后一帧
- 支持循环播放（使用播放次数设置）
- 使用现有的滚动函数系统（贝塞尔曲线、优化三次等）
- 显示倒计时

### 使用方法

1. **前提条件：** 至少需要录制2个或以上关键帧，并且有时间数据

2. **启动方式：**
   - **菜单栏按钮：** 点击"合成播放"按钮（蓝色高亮按钮）
   - **右键菜单：** 右键图片区域 → "🎬 合成播放"

3. **播放效果：**
   - 从第1个关键帧位置开始
   - 平滑滚动到最后1个关键帧位置
   - 滚动时长 = 所有关键帧时间之和
   - 循环播放（根据"播放次数"设置）

4. **停止播放：** 再次点击"停止合成"按钮

### 技术实现

**新增文件：**
- `Services/Implementations/CompositePlaybackService.cs` - 合成播放服务
- `Database/Models/Enums/PlaybackMode.cs` - 添加Composite枚举

**修改文件：**
- `Services/PlaybackServiceFactory.cs` - 注册合成播放服务
- `Core/ServiceCollectionExtensions.cs` - DI容器注册
- `UI/MainWindow.xaml` - 添加"合成播放"按钮
- `UI/MainWindow.Keyframe.cs` - 实现播放逻辑
- `UI/MainWindow.ContextMenu.cs` - 添加右键菜单项

**特点：**
- ✅ 复用现有架构（IPlaybackService接口）
- ✅ 支持所有滚动函数（贝塞尔、优化三次、线性等）
- ✅ 支持播放次数设置（1-10次或无限循环）
- ✅ 显示倒计时
- ✅ 支持FPS监控
- ✅ 支持投影更新
- ✅ **停止播放时立即停止滚动动画** - 当点击"停止合成"时，滚动动画会立即停止并重置状态
- ✅ **支持循环标记** - 有LoopCount标记的关键帧会停留在该位置，不滚动

### 循环逻辑说明

**场景示例：**
```
第1帧: Y=0,    时间=5秒,  LoopCount=null
第2帧: Y=500,  时间=10秒, LoopCount=2     ← 副歌，需要循环
第3帧: Y=1000, 时间=8秒,  LoopCount=null
第4帧: Y=2000, 时间=7秒,  LoopCount=null
```

**播放效果：**
1. **段1 - 滚动**：从Y=0滚动到Y=500，耗时5秒
2. **段2 - 停留**：画面停在Y=500不动，耗时10秒（副歌循环）
3. **段3 - 滚动**：从Y=500滚动到Y=2000，耗时15秒（8+7秒）

**核心规则：**
- 有LoopCount标记（≥2）的关键帧 → 画面停在该位置，停留时间=该帧录制时间
- 无LoopCount标记的关键帧 → 累积到滚动段，平滑滚动
- 总时长保持不变（仍是所有帧时间之和）