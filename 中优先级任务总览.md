# Canvas Cast V4.0.9 - 中优先级任务总览

生成日期：2025-10-17  
状态：📋 计划完成，准备执行

---

## 📚 文档导航

本次中优先级任务包含以下文档：

### 1. **TODO_中优先级执行计划.md** ⭐ 主文档
   - **作用**：详细的执行计划
   - **内容**：
     - 任务拆解（2个阶段，10个任务）
     - 时间规划（6-7周）
     - 执行步骤
     - 验收标准
     - 风险管理
   - **适合**：项目经理、开发团队

### 2. **拆分执行检查清单.md** ✅ 快速参考
   - **作用**：每日执行检查表
   - **内容**：
     - 每日任务清单
     - 快速状态表
     - 测试检查项
     - 问题诊断
   - **适合**：开发人员日常使用

### 3. **MainWindow拆分架构设计.md** 🏗️ 技术设计
   - **作用**：技术实施蓝图
   - **内容**：
     - 架构设计图
     - 模块详细设计
     - 依赖关系
     - 代码规范
   - **适合**：架构师、高级开发

### 4. **中优先级任务总览.md** 📋 本文档
   - **作用**：快速了解全局
   - **内容**：总体概览和使用指南

---

## 🎯 任务目标

### 主要目标
1. **统一命名规范** - 提高代码可读性
2. **拆分MainWindow类** - 降低复杂度

### 成功标准
- ✅ 所有字段使用统一命名（下划线前缀）
- ✅ 无魔法数字
- ✅ 异步方法有Async后缀
- ✅ MainWindow.xaml.cs从6003行减少到<1000行
- ✅ 代码结构清晰，职责明确
- ✅ 所有功能正常，无性能下降

---

## ⏱️ 时间规划

### 总体时间表

```
Week 1-2: 阶段一 - 命名规范统一
├── Week 1: 字段重命名 (5天)
└── Week 2: 常量和异步方法 (5天)

Week 3-7: 阶段二 - MainWindow拆分
├── Week 3: 分析设计 + Media模块启动 (5天)
├── Week 4: Media模块完成 (5天)
├── Week 5: Projection + TreeView模块 (5天)
├── Week 6: TreeView + ImageProcessing模块 (5天)
└── Week 7: EventHandlers + 最终整理 (5天)

总计：7周（35个工作日）
```

---

## 📊 当前状态 vs 目标状态

### 代码规模对比

| 指标 | 当前 | 目标 | 改善 |
|------|------|------|------|
| MainWindow行数 | 6003 | <1000 | -83% |
| 最大方法行数 | 200+ | <50 | -75% |
| 字段数量 | 40+ | 分散到各模块 | - |
| 方法数量 | 200+ | 分散到各模块 | - |
| 文件数量 | 1主文件+3部分类 | 1主文件+9部分类 | +6 |

### 代码质量对比

| 质量指标 | 当前 | 目标 |
|---------|------|------|
| 命名一致性 | ⚠️ 不一致 | ✅ 统一 |
| 魔法数字 | ⚠️ 存在 | ✅ 无 |
| 方法命名 | ⚠️ 不规范 | ✅ 规范 |
| 类复杂度 | 🔴 很高 | 🟢 低 |
| 可维护性 | 🟡 中等 | 🟢 高 |
| 可测试性 | 🟡 中等 | 🟢 高 |

---

## 🚀 快速开始指南

### 对于项目经理
1. **阅读**：TODO_中优先级执行计划.md
2. **关注**：进度追踪表
3. **审核**：每周工作成果

### 对于开发人员
1. **第一天**：
   - 阅读TODO_中优先级执行计划.md（30分钟）
   - 阅读MainWindow拆分架构设计.md（30分钟）
   - 打印拆分执行检查清单.md

2. **每天工作**：
   - 查看检查清单，选择今天的任务
   - 按步骤执行
   - 每完成一项，勾选检查清单
   - 每天结束前运行测试
   - 提交Git

3. **遇到问题**：
   - 参考架构设计文档
   - 记录Issue
   - 团队讨论

---

## 📁 拆分后的文件结构

```
UI/
├── MainWindow.xaml
├── MainWindow.xaml.cs (核心，<1000行)
│
├── 部分类 - 新建的
├── MainWindow.Core.cs (~800行) [新建]
├── MainWindow.Media.cs (~600行) [新建]
├── MainWindow.Projection.cs (~400行) [新建]
├── MainWindow.TreeView.cs (~500行) [新建]
├── MainWindow.ImageProcessing.cs (~600行) [新建]
├── MainWindow.EventHandlers.cs (~500行) [新建]
│
└── 部分类 - 已存在的
    ├── MainWindow.Keyframe.cs (1295行) [已存在]
    ├── MainWindow.Original.cs (558行) [已存在]
    └── MainWindow.TextEditor.cs [已存在]

总计：10个文件，清晰的职责划分
```

---

## 🎨 命名规范统一

### Before (当前)
```csharp
// ❌ 不一致
private VideoPlayerManager videoPlayerManager;
private Utils.GlobalHotKeyManager _globalHotKeyManager;
private ImageProcessor imageProcessor;
```

### After (目标)
```csharp
// ✅ 统一使用下划线前缀
private VideoPlayerManager _videoPlayerManager;
private GlobalHotKeyManager _globalHotKeyManager;
private ImageProcessor _imageProcessor;
```

### 常量提取

### Before (当前)
```csharp
// ❌ 魔法数字
if ((DateTime.Now - lastPlayModeClickTime).TotalMilliseconds < 300) 
    return;
```

### After (目标)
```csharp
// ✅ 常量定义
private const int BUTTON_DEBOUNCE_MILLISECONDS = 300;

if ((DateTime.Now - _lastPlayModeClickTime).TotalMilliseconds < BUTTON_DEBOUNCE_MILLISECONDS) 
    return;
```

---

## 🏗️ 模块拆分优先级

### 实施顺序（按优先级）

1. **MainWindow.Media.cs** (Week 3-4)
   - 原因：独立性强，依赖少
   - 收益：减少600行，提升媒体功能可维护性

2. **MainWindow.Projection.cs** (Week 5前半)
   - 原因：与Media相关，趁热拆分
   - 收益：减少400行

3. **MainWindow.TreeView.cs** (Week 5后半-Week 6前半)
   - 原因：UI逻辑复杂，需要仔细处理
   - 收益：减少500行

4. **MainWindow.ImageProcessing.cs** (Week 6后半)
   - 原因：核心功能，需要充分测试
   - 收益：减少600行

5. **MainWindow.EventHandlers.cs** (Week 7前半)
   - 原因：协调各模块，最后拆分
   - 收益：减少500行

6. **MainWindow.Core.cs** (Week 7后半)
   - 原因：最后整理，保留核心
   - 收益：主文件精简到<1000行

---

## ✅ 验收检查

### 阶段一验收（Week 2结束）
- [ ] 所有私有字段使用下划线前缀
- [ ] 所有魔法数字提取为常量
- [ ] 所有异步方法有Async后缀
- [ ] 编译无错误
- [ ] 功能测试通过
- [ ] Git提交并打标签

### 阶段二验收（Week 7结束）
- [ ] MainWindow.xaml.cs < 1000行
- [ ] 所有部分类创建完成
- [ ] 每个模块职责清晰
- [ ] 无重复代码
- [ ] 编译无错误无警告
- [ ] 完整回归测试通过
- [ ] 性能测试无下降
- [ ] 代码审查通过
- [ ] 文档更新完成
- [ ] Git提交并打标签

---

## 📞 支持和协作

### 团队角色
- **架构师**：审查设计，把控方向
- **开发人员**：执行拆分，编写代码
- **测试人员**：功能测试，回归测试
- **项目经理**：进度跟踪，风险管理

### 沟通渠道
- **每日站会**：5分钟同步进度
- **周例会**：回顾本周，计划下周
- **代码审查**：每个任务完成后
- **问题讨论**：随时在Issue中讨论

---

## 🎓 学习资源

### 推荐阅读
1. **C# Coding Conventions** (Microsoft官方)
2. **Clean Code** (Robert C. Martin)
3. **Refactoring** (Martin Fowler)
4. **WPF Best Practices**

### 重构模式
- **Extract Class** - 提取类
- **Move Method** - 移动方法
- **Rename** - 重命名
- **Replace Magic Number with Constant** - 魔法数字转常量

---

## 📈 预期收益

### 短期收益（1-2个月）
- ✅ 代码更易读
- ✅ 更容易找到代码
- ✅ 降低修改风险
- ✅ 提高开发效率

### 长期收益（3-6个月）
- ✅ 更容易添加新功能
- ✅ 更容易修复Bug
- ✅ 更容易进行单元测试
- ✅ 团队成员更容易上手
- ✅ 降低技术债务

---

## 🚨 注意事项

### 风险提示
⚠️ **不要急于求成**
- 按计划逐步进行
- 每个任务充分测试
- 出现问题及时回滚

⚠️ **保持功能完整**
- 不要在重构时添加新功能
- 不要修改业务逻辑
- 保持向后兼容

⚠️ **频繁提交**
- 每完成一个小任务就提交
- 写清晰的提交信息
- 使用分支隔离风险

---

## 📝 下一步行动

### 立即行动
1. ✅ 阅读所有文档（2小时）
2. ✅ 团队会议，讨论计划（1小时）
3. ✅ 创建Git分支
4. ✅ 开始第一个任务：字段重命名

### 本周目标
- [ ] 完成所有Manager字段重命名
- [ ] 完成所有核心字段重命名
- [ ] 编译测试通过
- [ ] 功能测试通过

---

## 🎉 结语

这是一个重要的代码质量提升计划。虽然工作量不小（6-7周），但收益是长期的。

**记住**：
- 📖 随时参考文档
- 🧪 频繁测试
- 💬 多沟通
- ✅ 每天进步一点

**让我们开始吧！** 🚀

---

**文档版本**: 1.0  
**最后更新**: 2025-10-17  
**状态**: ✅ 计划完成，准备执行  
**下次审查**: 每周五

