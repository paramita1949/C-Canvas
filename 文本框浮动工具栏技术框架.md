# æ–‡æœ¬æ¡†æµ®åŠ¨å·¥å…·æ æŠ€æœ¯æ¡†æ¶è®¾è®¡æ–‡æ¡£

> **é¡¹ç›®åç§°**: Canvas Cast æ–‡æœ¬ç¼–è¾‘å™¨  
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-02  
> **æŠ€æœ¯æ ˆ**: WPF + SkiaSharp + MVVM

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [ç»„ä»¶è®¾è®¡](#ç»„ä»¶è®¾è®¡)
3. [äº¤äº’æµç¨‹](#äº¤äº’æµç¨‹)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
6. [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
7. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## ğŸ—ï¸ æ¶æ„æ¦‚è¿°

### è®¾è®¡ç›®æ ‡

å®ç°ç±»ä¼¼ä¸“ä¸šè®¾è®¡è½¯ä»¶ï¼ˆFigmaã€Canvaï¼‰çš„æ–‡æœ¬ç¼–è¾‘ä½“éªŒï¼š
- âœ… ç‚¹å‡»æ–‡æœ¬æ¡†æ—¶ï¼Œæ˜¾ç¤ºæµ®åŠ¨å·¥å…·æ 
- âœ… ç‚¹å‡»å·¥å…·å›¾æ ‡ï¼Œå¼¹å‡ºå±æ€§ç¼–è¾‘é¢æ¿
- âœ… å®æ—¶é¢„è§ˆç¼–è¾‘æ•ˆæœ
- âœ… æ”¯æŒè¾¹æ¡†ã€èƒŒæ™¯ã€æ–‡å­—ã€ç‰¹æ•ˆç­‰å¤šç§å±æ€§

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI äº¤äº’å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ–‡æœ¬æ¡†æ§ä»¶    â”‚  â”‚ æµ®åŠ¨å·¥å…·æ     â”‚  â”‚ å±æ€§é¢æ¿      â”‚  â”‚
â”‚  â”‚ SkiaTextBox  â”‚  â”‚FloatingToolbarâ”‚  â”‚PropertyPanel â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ViewModel å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         TextBoxViewModel (MVVM)                   â”‚  â”‚
â”‚  â”‚  - BorderProperties (è¾¹æ¡†å±æ€§)                     â”‚  â”‚
â”‚  â”‚  - BackgroundProperties (èƒŒæ™¯å±æ€§)                 â”‚  â”‚
â”‚  â”‚  - TextProperties (æ–‡å­—å±æ€§)                       â”‚  â”‚
â”‚  â”‚  - EffectProperties (ç‰¹æ•ˆå±æ€§)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ¸²æŸ“å±‚ (SkiaSharp)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         SkiaTextRenderer                          â”‚  â”‚
â”‚  â”‚  - RenderBorder() (æ¸²æŸ“è¾¹æ¡†)                       â”‚  â”‚
â”‚  â”‚  - RenderBackground() (æ¸²æŸ“èƒŒæ™¯)                   â”‚  â”‚
â”‚  â”‚  - RenderText() (æ¸²æŸ“æ–‡å­—)                         â”‚  â”‚
â”‚  â”‚  - RenderEffects() (æ¸²æŸ“ç‰¹æ•ˆ)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®æŒä¹…åŒ–å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         TextElement (Entity Framework)            â”‚  â”‚
â”‚  â”‚  - å­˜å‚¨åˆ° SQLite æ•°æ®åº“                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ç»„ä»¶è®¾è®¡

### 1. SkiaTextBoxï¼ˆæ–‡æœ¬æ¡†æ§ä»¶ï¼‰

**èŒè´£**ï¼š
- æ¸²æŸ“æ–‡æœ¬å†…å®¹å’Œæ ·å¼
- å¤„ç†é¼ æ ‡äº¤äº’ï¼ˆé€‰ä¸­ã€æ‹–æ‹½ã€ç¼©æ”¾ï¼‰
- è§¦å‘æµ®åŠ¨å·¥å…·æ æ˜¾ç¤º

**å…³é”®å±æ€§**ï¼š
```csharp
public class SkiaTextBox : SKElement
{
    // åŸºç¡€å±æ€§
    public string Text { get; set; }
    public float FontSize { get; set; }
    public SKColor TextColor { get; set; }
    
    // è¾¹æ¡†å±æ€§
    public BorderProperties Border { get; set; }
    
    // èƒŒæ™¯å±æ€§
    public BackgroundProperties Background { get; set; }
    
    // ç‰¹æ•ˆå±æ€§
    public EffectProperties Effects { get; set; }
    
    // çŠ¶æ€
    public bool IsSelected { get; set; }
    public bool IsEditing { get; set; }
}
```

---

### 2. FloatingToolbarï¼ˆæµ®åŠ¨å·¥å…·æ ï¼‰

**èŒè´£**ï¼š
- åœ¨æ–‡æœ¬æ¡†é€‰ä¸­æ—¶æ˜¾ç¤º
- æä¾›å¿«æ·æ“ä½œå›¾æ ‡
- è§¦å‘å±æ€§é¢æ¿å¼¹å‡º

**UI ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¨  ğŸ“  ğŸ–¼ï¸  âœ¨  ğŸ”¤  ğŸ“  ğŸ­  âš™ï¸          â”‚  â† å·¥å…·å›¾æ ‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  è¾¹æ¡† èƒŒæ™¯ å›¾ç‰‡ ç‰¹æ•ˆ æ–‡å­— å¯¹é½ å›¾å±‚ è®¾ç½®
```

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨ WPF `Popup` æˆ– `Adorner`
- è‡ªåŠ¨å®šä½åˆ°æ–‡æœ¬æ¡†ä¸Šæ–¹/ä¸‹æ–¹
- æ”¯æŒæ‹–æ‹½ç§»åŠ¨

---

### 3. PropertyPanelï¼ˆå±æ€§é¢æ¿ï¼‰

**èŒè´£**ï¼š
- æ˜¾ç¤ºè¯¦ç»†çš„å±æ€§ç¼–è¾‘æ§ä»¶
- å®æ—¶é¢„è§ˆæ•ˆæœ
- æ”¯æŒæ’¤é”€/é‡åš

**é¢æ¿ç±»å‹**ï¼š

#### 3.1 è¾¹æ¡†å±æ€§é¢æ¿ï¼ˆBorderPropertyPanelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾¹æ¡†è®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢œè‰²:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #3498db      â”‚
â”‚  é€æ˜åº¦: [â”â”â”â”â”â”â”â”â”â”] 100%      â”‚
â”‚  å®½åº¦:  [â”â”â”â”â”â”â”â”â”â”] 2px        â”‚
â”‚  åœ†è§’:  [â”â”â”â”â”â”â”â”â”â”] 20px       â”‚
â”‚  æ ·å¼:  [å®çº¿ â–¼]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¢„è§ˆ]  [åº”ç”¨]  [å–æ¶ˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 èƒŒæ™¯å±æ€§é¢æ¿ï¼ˆBackgroundPropertyPanelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èƒŒæ™¯è®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç±»å‹:  âšª çº¯è‰²  âš« æ¸å˜  âšª å›¾ç‰‡ â”‚
â”‚  é¢œè‰²:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #2ecc71      â”‚
â”‚  é€æ˜åº¦: [â”â”â”â”â”â”â”â”â”â”] 80%       â”‚
â”‚  æ¨¡ç³Š:  [â”â”â”â”â”â”â”â”â”â”] 0px        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¸å˜è®¾ç½® (å¯é€‰)                 â”‚
â”‚  èµ·å§‹è‰²: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #3498db     â”‚
â”‚  ç»“æŸè‰²: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #9b59b6     â”‚
â”‚  è§’åº¦:  [â”â”â”â”â”â”â”â”â”â”] 45Â°        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¢„è§ˆ]  [åº”ç”¨]  [å–æ¶ˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3 æ–‡å­—å±æ€§é¢æ¿ï¼ˆTextPropertyPanelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡å­—è®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­—ä½“:  [Microsoft YaHei â–¼]     â”‚
â”‚  å­—å·:  [â”â”â”â”â”â”â”â”â”â”] 20px       â”‚
â”‚  é¢œè‰²:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #ffffff      â”‚
â”‚  å­—é—´è·: [â”â”â”â”â”â”â”â”â”â”] 0px       â”‚
â”‚  è¡Œé—´è·: [â”â”â”â”â”â”â”â”â”â”] 1.5       â”‚
â”‚  å¯¹é½:  [å·¦] [ä¸­] [å³] [ä¸¤ç«¯]    â”‚
â”‚  æ ·å¼:  [B] [I] [U] [S]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¢„è§ˆ]  [åº”ç”¨]  [å–æ¶ˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4 ç‰¹æ•ˆå±æ€§é¢æ¿ï¼ˆEffectPropertyPanelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰¹æ•ˆè®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜‘ é˜´å½±                         â”‚
â”‚    é¢œè‰²:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #000000    â”‚
â”‚    åç§»X: [â”â”â”â”â”â”â”â”â”â”] 2px      â”‚
â”‚    åç§»Y: [â”â”â”â”â”â”â”â”â”â”] 2px      â”‚
â”‚    æ¨¡ç³Š:  [â”â”â”â”â”â”â”â”â”â”] 4px      â”‚
â”‚                                 â”‚
â”‚  â˜‘ æè¾¹                         â”‚
â”‚    é¢œè‰²:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] #000000    â”‚
â”‚    å®½åº¦:  [â”â”â”â”â”â”â”â”â”â”] 2px      â”‚
â”‚                                 â”‚
â”‚  â˜ å‘å…‰                         â”‚
â”‚  â˜ æ¨¡ç³Š                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¢„è§ˆ]  [åº”ç”¨]  [å–æ¶ˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ äº¤äº’æµç¨‹

### æµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹å‡»æ–‡æœ¬æ¡†] --> B{æ–‡æœ¬æ¡†æ˜¯å¦å·²é€‰ä¸­?}
    B -->|å¦| C[é€‰ä¸­æ–‡æœ¬æ¡†]
    B -->|æ˜¯| D[ä¿æŒé€‰ä¸­çŠ¶æ€]
    C --> E[æ˜¾ç¤ºæµ®åŠ¨å·¥å…·æ ]
    D --> E
    E --> F[ç”¨æˆ·ç‚¹å‡»å·¥å…·å›¾æ ‡]
    F --> G[å¼¹å‡ºå±æ€§é¢æ¿]
    G --> H[ç”¨æˆ·ä¿®æ”¹å±æ€§]
    H --> I[å®æ—¶é¢„è§ˆæ•ˆæœ]
    I --> J{ç”¨æˆ·æ“ä½œ?}
    J -->|ç‚¹å‡»åº”ç”¨| K[ä¿å­˜å±æ€§åˆ°æ•°æ®åº“]
    J -->|ç‚¹å‡»å–æ¶ˆ| L[æ¢å¤åŸå§‹å±æ€§]
    J -->|ç»§ç»­ç¼–è¾‘| H
    K --> M[å…³é—­å±æ€§é¢æ¿]
    L --> M
    M --> N[æ›´æ–°æ–‡æœ¬æ¡†æ¸²æŸ“]
    N --> O[ç»“æŸ]
```

### è¯¦ç»†æ­¥éª¤

#### æ­¥éª¤ 1ï¼šé€‰ä¸­æ–‡æœ¬æ¡†
```csharp
// ç”¨æˆ·ç‚¹å‡»æ–‡æœ¬æ¡†
private void OnTextBoxMouseDown(object sender, MouseButtonEventArgs e)
{
    // 1. å–æ¶ˆå…¶ä»–æ–‡æœ¬æ¡†çš„é€‰ä¸­çŠ¶æ€
    DeselectAllTextBoxes();
    
    // 2. é€‰ä¸­å½“å‰æ–‡æœ¬æ¡†
    var textBox = sender as SkiaTextBox;
    textBox.IsSelected = true;
    
    // 3. æ˜¾ç¤ºæµ®åŠ¨å·¥å…·æ 
    ShowFloatingToolbar(textBox);
}
```

#### æ­¥éª¤ 2ï¼šæ˜¾ç¤ºæµ®åŠ¨å·¥å…·æ 
```csharp
private void ShowFloatingToolbar(SkiaTextBox textBox)
{
    // 1. åˆ›å»ºæˆ–è·å–æµ®åŠ¨å·¥å…·æ 
    if (_floatingToolbar == null)
    {
        _floatingToolbar = new FloatingToolbar();
        _floatingToolbar.ToolClicked += OnToolClicked;
    }
    
    // 2. è®¡ç®—å·¥å…·æ ä½ç½®ï¼ˆæ–‡æœ¬æ¡†ä¸Šæ–¹ï¼‰
    var position = CalculateToolbarPosition(textBox);
    
    // 3. æ˜¾ç¤ºå·¥å…·æ 
    _floatingToolbar.Show(position);
}
```

#### æ­¥éª¤ 3ï¼šå¼¹å‡ºå±æ€§é¢æ¿
```csharp
private void OnToolClicked(object sender, ToolClickedEventArgs e)
{
    switch (e.ToolType)
    {
        case ToolType.Border:
            ShowBorderPropertyPanel();
            break;
        case ToolType.Background:
            ShowBackgroundPropertyPanel();
            break;
        case ToolType.Text:
            ShowTextPropertyPanel();
            break;
        case ToolType.Effects:
            ShowEffectPropertyPanel();
            break;
    }
}
```

#### æ­¥éª¤ 4ï¼šå®æ—¶é¢„è§ˆ
```csharp
// å±æ€§é¢æ¿ä¸­çš„æ»‘å—å˜åŒ–äº‹ä»¶
private void OnBorderWidthChanged(object sender, RoutedPropertyChangedEventArgs<double> e)
{
    // 1. æ›´æ–° ViewModel
    _viewModel.Border.Width = (float)e.NewValue;
    
    // 2. è§¦å‘æ–‡æœ¬æ¡†é‡ç»˜ï¼ˆå®æ—¶é¢„è§ˆï¼‰
    _selectedTextBox.InvalidateVisual();
}
```

---

## ğŸ“¦ æ•°æ®æ¨¡å‹

### BorderPropertiesï¼ˆè¾¹æ¡†å±æ€§ï¼‰

```csharp
public class BorderProperties : INotifyPropertyChanged
{
    private SKColor _color = SKColors.Black;
    private float _opacity = 1.0f;
    private float _width = 2.0f;
    private float _cornerRadius = 0.0f;
    private BorderStyle _style = BorderStyle.Solid;
    
    public SKColor Color
    {
        get => _color;
        set { _color = value; OnPropertyChanged(); }
    }
    
    public float Opacity
    {
        get => _opacity;
        set { _opacity = Math.Clamp(value, 0f, 1f); OnPropertyChanged(); }
    }
    
    public float Width
    {
        get => _width;
        set { _width = Math.Max(0, value); OnPropertyChanged(); }
    }
    
    public float CornerRadius
    {
        get => _cornerRadius;
        set { _cornerRadius = Math.Max(0, value); OnPropertyChanged(); }
    }
    
    public BorderStyle Style
    {
        get => _style;
        set { _style = value; OnPropertyChanged(); }
    }
    
    public event PropertyChangedEventHandler PropertyChanged;
    protected void OnPropertyChanged([CallerMemberName] string name = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

public enum BorderStyle
{
    Solid,      // å®çº¿
    Dashed,     // è™šçº¿
    Dotted,     // ç‚¹çº¿
    Double      // åŒçº¿
}
```

### BackgroundPropertiesï¼ˆèƒŒæ™¯å±æ€§ï¼‰

```csharp
public class BackgroundProperties : INotifyPropertyChanged
{
    private BackgroundType _type = BackgroundType.SolidColor;
    private SKColor _color = SKColors.Transparent;
    private float _opacity = 1.0f;
    private float _blur = 0.0f;
    
    // æ¸å˜å±æ€§
    private SKColor _gradientStartColor = SKColors.Blue;
    private SKColor _gradientEndColor = SKColors.Purple;
    private float _gradientAngle = 0.0f;
    
    public BackgroundType Type { get; set; }
    public SKColor Color { get; set; }
    public float Opacity { get; set; }
    public float Blur { get; set; }
    
    // æ¸å˜
    public SKColor GradientStartColor { get; set; }
    public SKColor GradientEndColor { get; set; }
    public float GradientAngle { get; set; }
    
    // å›¾ç‰‡
    public string ImagePath { get; set; }
}

public enum BackgroundType
{
    None,           // æ— èƒŒæ™¯
    SolidColor,     // çº¯è‰²
    Gradient,       // æ¸å˜
    Image           // å›¾ç‰‡
}
```

### TextElementï¼ˆæ•°æ®åº“å®ä½“æ‰©å±•ï¼‰

```csharp
// æ‰©å±•ç°æœ‰çš„ TextElement æ¨¡å‹
public partial class TextElement
{
    // è¾¹æ¡†å±æ€§ï¼ˆJSON åºåˆ—åŒ–ï¼‰
    [Column("border_properties")]
    public string BorderPropertiesJson { get; set; }
    
    [NotMapped]
    public BorderProperties Border
    {
        get => string.IsNullOrEmpty(BorderPropertiesJson) 
            ? new BorderProperties() 
            : JsonSerializer.Deserialize<BorderProperties>(BorderPropertiesJson);
        set => BorderPropertiesJson = JsonSerializer.Serialize(value);
    }
    
    // èƒŒæ™¯å±æ€§ï¼ˆJSON åºåˆ—åŒ–ï¼‰
    [Column("background_properties")]
    public string BackgroundPropertiesJson { get; set; }
    
    [NotMapped]
    public BackgroundProperties Background
    {
        get => string.IsNullOrEmpty(BackgroundPropertiesJson) 
            ? new BackgroundProperties() 
            : JsonSerializer.Deserialize<BackgroundProperties>(BackgroundPropertiesJson);
        set => BackgroundPropertiesJson = JsonSerializer.Serialize(value);
    }
}
```

---

## ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ WPF Popupï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… åŸç”Ÿ WPF æ§ä»¶ï¼Œç¨³å®šå¯é 
- âœ… è‡ªåŠ¨å¤„ç†çª—å£è¾¹ç•Œ
- âœ… æ”¯æŒåŠ¨ç”»æ•ˆæœ

**å®ç°**ï¼š
```csharp
public class FloatingToolbar : Popup
{
    private StackPanel _toolPanel;
    
    public FloatingToolbar()
    {
        // åˆ›å»ºå·¥å…·æ å†…å®¹
        _toolPanel = new StackPanel
        {
            Orientation = Orientation.Horizontal,
            Background = new SolidColorBrush(Color.FromArgb(230, 50, 50, 50)),
            Margin = new Thickness(5)
        };
        
        // æ·»åŠ å·¥å…·æŒ‰é’®
        AddToolButton("ğŸ¨", ToolType.Border, "è¾¹æ¡†");
        AddToolButton("ğŸ–¼ï¸", ToolType.Background, "èƒŒæ™¯");
        AddToolButton("ğŸ”¤", ToolType.Text, "æ–‡å­—");
        AddToolButton("âœ¨", ToolType.Effects, "ç‰¹æ•ˆ");
        
        Child = _toolPanel;
        StaysOpen = false;
        AllowsTransparency = true;
    }
    
    private void AddToolButton(string icon, ToolType type, string tooltip)
    {
        var button = new Button
        {
            Content = icon,
            Width = 40,
            Height = 40,
            Margin = new Thickness(2),
            ToolTip = tooltip,
            Tag = type
        };
        
        button.Click += (s, e) => OnToolClicked(type);
        _toolPanel.Children.Add(button);
    }
}
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ Adorner Layer

**ä¼˜ç‚¹**ï¼š
- âœ… æ›´çµæ´»çš„å®šä½
- âœ… å¯ä»¥è¦†ç›–åœ¨ä»»ä½•æ§ä»¶ä¸Š
- âœ… æ”¯æŒå¤æ‚çš„è§†è§‰æ•ˆæœ

**å®ç°**ï¼š
```csharp
public class FloatingToolbarAdorner : Adorner
{
    private VisualCollection _visuals;
    private ContentPresenter _presenter;
    
    public FloatingToolbarAdorner(UIElement adornedElement) : base(adornedElement)
    {
        _visuals = new VisualCollection(this);
        
        // åˆ›å»ºå·¥å…·æ å†…å®¹
        var toolbar = CreateToolbar();
        _presenter = new ContentPresenter { Content = toolbar };
        _visuals.Add(_presenter);
    }
    
    protected override Visual GetVisualChild(int index) => _visuals[index];
    protected override int VisualChildrenCount => _visuals.Count;
    
    protected override Size ArrangeOverride(Size finalSize)
    {
        // å®šä½å·¥å…·æ åˆ°æ–‡æœ¬æ¡†ä¸Šæ–¹
        var desiredSize = _presenter.DesiredSize;
        var x = (finalSize.Width - desiredSize.Width) / 2;
        var y = -desiredSize.Height - 10;
        
        _presenter.Arrange(new Rect(new Point(x, y), desiredSize));
        return finalSize;
    }
}
```

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ï¼šè¾¹æ¡†ç¼–è¾‘æµç¨‹

```csharp
// 1. ç”¨æˆ·ç‚¹å‡»è¾¹æ¡†å·¥å…·å›¾æ ‡
private void OnBorderToolClicked()
{
    // åˆ›å»ºè¾¹æ¡†å±æ€§é¢æ¿
    var panel = new BorderPropertyPanel
    {
        DataContext = _selectedTextBox.Border
    };
    
    // è®¢é˜…å±æ€§å˜åŒ–äº‹ä»¶ï¼ˆå®æ—¶é¢„è§ˆï¼‰
    panel.PropertyChanged += (s, e) =>
    {
        _selectedTextBox.InvalidateVisual();
    };
    
    // æ˜¾ç¤ºé¢æ¿
    ShowPropertyPanel(panel);
}

// 2. è¾¹æ¡†å±æ€§é¢æ¿ XAML
/*
<UserControl x:Class="BorderPropertyPanel">
    <StackPanel Margin="10">
        <TextBlock Text="è¾¹æ¡†è®¾ç½®" FontSize="16" FontWeight="Bold"/>
        
        <!-- é¢œè‰²é€‰æ‹©å™¨ -->
        <StackPanel Margin="0,10,0,0">
            <TextBlock Text="é¢œè‰²"/>
            <ColorPicker SelectedColor="{Binding Color, Mode=TwoWay}"/>
        </StackPanel>
        
        <!-- é€æ˜åº¦æ»‘å— -->
        <StackPanel Margin="0,10,0,0">
            <TextBlock Text="é€æ˜åº¦"/>
            <Slider Minimum="0" Maximum="1" Value="{Binding Opacity, Mode=TwoWay}"
                    ValueChanged="OnOpacityChanged"/>
        </StackPanel>
        
        <!-- å®½åº¦æ»‘å— -->
        <StackPanel Margin="0,10,0,0">
            <TextBlock Text="å®½åº¦"/>
            <Slider Minimum="0" Maximum="20" Value="{Binding Width, Mode=TwoWay}"
                    ValueChanged="OnWidthChanged"/>
        </StackPanel>
        
        <!-- åœ†è§’æ»‘å— -->
        <StackPanel Margin="0,10,0,0">
            <TextBlock Text="åœ†è§’"/>
            <Slider Minimum="0" Maximum="50" Value="{Binding CornerRadius, Mode=TwoWay}"
                    ValueChanged="OnCornerRadiusChanged"/>
        </StackPanel>
        
        <!-- æŒ‰é’® -->
        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
            <Button Content="åº”ç”¨" Click="OnApplyClicked"/>
            <Button Content="å–æ¶ˆ" Click="OnCancelClicked"/>
        </StackPanel>
    </StackPanel>
</UserControl>
*/

// 3. SkiaSharp æ¸²æŸ“è¾¹æ¡†
private void RenderBorder(SKCanvas canvas, BorderProperties border)
{
    if (border.Width <= 0)
        return;
    
    using var paint = new SKPaint
    {
        Style = SKPaintStyle.Stroke,
        Color = border.Color.WithAlpha((byte)(border.Opacity * 255)),
        StrokeWidth = border.Width,
        IsAntialias = true
    };
    
    // æ ¹æ®æ ·å¼è®¾ç½®è™šçº¿æ•ˆæœ
    if (border.Style == BorderStyle.Dashed)
    {
        paint.PathEffect = SKPathEffect.CreateDash(new[] { 10f, 5f }, 0);
    }
    else if (border.Style == BorderStyle.Dotted)
    {
        paint.PathEffect = SKPathEffect.CreateDash(new[] { 2f, 2f }, 0);
    }
    
    // ç»˜åˆ¶åœ†è§’çŸ©å½¢
    var rect = new SKRect(0, 0, Width, Height);
    canvas.DrawRoundRect(rect, border.CornerRadius, border.CornerRadius, paint);
}
```

---

## ğŸ”Œ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶åŒ–å·¥å…·ç³»ç»Ÿ

```csharp
// å·¥å…·æ¥å£
public interface ITool
{
    string Name { get; }
    string Icon { get; }
    ToolType Type { get; }
    
    UserControl CreatePropertyPanel();
    void Apply(SkiaTextBox textBox);
}

// å·¥å…·ç®¡ç†å™¨
public class ToolManager
{
    private Dictionary<ToolType, ITool> _tools = new();
    
    public void RegisterTool(ITool tool)
    {
        _tools[tool.Type] = tool;
    }
    
    public ITool GetTool(ToolType type)
    {
        return _tools.TryGetValue(type, out var tool) ? tool : null;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
var toolManager = new ToolManager();
toolManager.RegisterTool(new BorderTool());
toolManager.RegisterTool(new BackgroundTool());
toolManager.RegisterTool(new TextTool());
toolManager.RegisterTool(new EffectTool());
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå·¥å…·æ ã€å±æ€§é¢æ¿ã€æ¸²æŸ“å™¨ç‹¬ç«‹è§£è€¦
2. **å®æ—¶é¢„è§ˆ**ï¼šMVVM æ•°æ®ç»‘å®š + SkiaSharp é«˜æ€§èƒ½æ¸²æŸ“
3. **å¯æ‰©å±•æ€§**ï¼šæ’ä»¶åŒ–å·¥å…·ç³»ç»Ÿï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
4. **ç”¨æˆ·ä½“éªŒ**ï¼šç±»ä¼¼ä¸“ä¸šè®¾è®¡è½¯ä»¶çš„äº¤äº’æµç¨‹

### æŠ€æœ¯äº®ç‚¹

- âœ… WPF + SkiaSharp æ··åˆæ¶æ„
- âœ… MVVM æ¨¡å¼ç®¡ç†çŠ¶æ€
- âœ… JSON åºåˆ—åŒ–å­˜å‚¨å¤æ‚å±æ€§
- âœ… å®æ—¶é¢„è§ˆ + æ’¤é”€/é‡åšæ”¯æŒ

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Canvas Cast Team  
**æœ€åæ›´æ–°**: 2025-11-02

