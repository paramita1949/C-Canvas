# Canvas Cast 功能使用说明

> **版本**: V5.0.9  
> **适用平台**: Windows 10/11  
> **最后更新**: 2025-10-22  

---

## 📋 目录

1. [快速入门](#快速入门)
2. [核心功能](#核心功能)
3. [关键帧模式](#关键帧模式)
4. [原图模式](#原图模式)
5. [投影功能](#投影功能)
6. [视频播放](#视频播放)
7. [文本幻灯片](#文本幻灯片)
8. [图片效果](#图片效果)
9. [快捷键列表](#快捷键列表)
10. [常见问题](#常见问题)

---

## 快速入门

### 首次启动

1. **双击运行** `CanvasCast.exe`
2. **导入文件夹**: 
   - 点击菜单栏 "导入" 按钮
   - 选择包含图片/视频的文件夹
   - 程序会自动扫描并导入所有媒体文件

3. **浏览图片**:
   - 在左侧项目树中点击文件夹展开
   - 点击文件名即可在右侧主区域查看
   - 使用 `PgUp`/`PgDown` 快速切换上下图片

### 界面布局

```
┌──────────────────────────────────────────────────────┐
│  [导入] [投影] [录制] [播放] [停止] [设置] [联系]     │  ← 菜单栏
├─────────────┬────────────────────────────────────────┤
│             │                                        │
│  📁 文件夹1 │                                        │
│    ├ 图片1  │          主显示区域                     │  ← 主要内容区
│    ├ 图片2  │      (图片/视频/文本编辑器)             │
│    └ 视频1  │                                        │
│  📁 文件夹2 │                                        │
│             │                                        │
│  [搜索框]   │                                        │
│             │                                        │
├─────────────┴────────────────────────────────────────┤
│  [播放控制栏]  ▶ ⏸ ⏹  倒计时: 00:15  循环:✓         │  ← 播放控制
└──────────────────────────────────────────────────────┘
```

---

## 核心功能

### 1. 文件管理

#### 导入文件夹
- **操作**: 点击 "导入" → 选择文件夹
- **支持格式**: 
  - 图片: JPG, PNG, BMP, GIF, TIF
  - 视频: MP4, AVI, MKV, MOV, WMV, FLV
  - 音频: MP3, WAV, FLAC, OGG, M4A, AAC

#### 文件夹操作
- **右键菜单**:
  - `⬆️ 上移` / `⬇️ 下移`: 调整文件夹顺序
  - `🎨 标记高亮色`: 自定义文件夹颜色
  - `🗑 删除文件夹`: 删除文件夹及其文件
  - `🔄 自动变色`: 标记文件夹内图片自动开启变色效果
  - `🎬 播放模式`: 设置视频播放模式

- **拖拽排序**: 直接拖动文件夹到目标位置

#### 文件操作
- **手动排序**: 拖动文件到目标位置（文件夹会自动标记为"手动排序"）
- **删除文件**: 右键 → 删除
- **重命名**: 右键 → 重命名（修改数据库记录，不修改文件名）

### 2. 图片浏览

#### 缩放控制
- **滚轮缩放**: `Ctrl + 鼠标滚轮`
- **缩放范围**: 0.1倍 ~ 10倍
- **重置缩放**: 切换图片自动重置为1.0倍

#### 滚动浏览
- **鼠标拖拽**: 按住左键拖动图片
- **滚轮滚动**: 上下滚动查看长图
- **快捷切换**: 
  - `PgUp`: 上一张
  - `PgDown`: 下一张
  - `Home`: 第一张
  - `End`: 最后一张

#### 显示模式
- **正常模式**: 宽度填满屏幕，高度按比例缩放，支持滚动
- **原图模式**: 
  - 适中模式: 等比缩放，完整显示
  - 拉伸模式: 宽度填满，高度按比例

---

## 关键帧模式

### 什么是关键帧？

关键帧是图片上预设的"停留位置"，播放时会按时间顺序自动滚动到这些位置。适用于：
- 📖 长图解说演示
- 📊 数据图表讲解
- 📝 文档逐段展示

### 录制关键帧

#### 步骤
1. **选择图片**: 点击左侧树中的图片文件
2. **滚动到目标位置**: 手动滚动到想要停留的位置
3. **录制关键帧**: 点击菜单栏 "录制" 按钮（或按 `F2`）
4. **继续录制**: 滚动到下一个位置，再次点击 "录制"
5. **完成录制**: 录制完所有关键帧后，点击 "停止录制"

#### 关键帧显示
- **绿色线条**: 当前已录制的关键帧位置
- **红色指示器**: 当前选中的关键帧
- **关键帧列表**: 显示所有关键帧的Y坐标和序号

### 播放关键帧

#### 开始播放
1. 点击菜单栏 "播放" 按钮（或按 `空格键`）
2. 图片会自动滚动到第一个关键帧
3. 按预设时间间隔自动跳转到下一个关键帧
4. 播放完成后自动停止或循环

#### 播放控制
- **播放/暂停**: 点击 `▶` 按钮或按 `空格键`
- **停止**: 点击 `⏹` 按钮或按 `ESC`
- **上一帧**: 点击 `⬆` 按钮或按 `PgUp`
- **下一帧**: 点击 `⬇` 按钮或按 `PgDown`

#### 播放设置

**滚动速度**:
- 右键关键帧指示器 → `⏱ 设置滚动速度`
- 输入秒数（如8秒、10秒）

**滚动函数**:
- 右键关键帧指示器 → `📐 设置滚动函数`
- 选项:
  - ✅ 线性滚动（匀速）
  - 🎢 贝塞尔曲线（先快后慢）
  - 其他缓动函数（EaseIn/EaseOut等）

**循环模式**:
- 勾选播放控制栏的 "循环" 复选框
- 播放到最后一帧后自动返回第一帧

### 关键帧管理

#### 清除关键帧
- **单个清除**: 右键关键帧指示器 → `❌ 清除关键帧`
- **全部清除**: 右键关键帧指示器 → `🗑 清除所有关键帧`

#### 手动跳转
- 点击关键帧指示器上的绿色线条
- 图片会立即滚动到该关键帧位置

---

## 原图模式

### 什么是原图模式？

原图模式用于**相似图片的循环展示**，常用于：
- 📸 同一场景的多张照片对比
- 🎨 不同版本的设计稿切换
- 📊 相同模板的不同数据图表

### 标记原图

#### 单张图片标记
1. **右键图片** → `原图顺序` 或 `原图循环`
   - **原图顺序**: 按文件名顺序播放相似图片
   - **原图循环**: 循环播放相似图片

#### 文件夹批量标记
1. **右键文件夹** → `原图顺序` 或 `原图循环`
2. 文件夹内所有图片都会应用该标记

### 原图播放

#### 相似图片识别规则
- **文件名差异≤1**: 
  - 例如: `图片1.jpg`, `图片2.jpg`, `图片3.jpg`
  - 或: `设计稿-v1.png`, `设计稿-v2.png`

#### 播放流程
1. 点击已标记的原图
2. 点击 "播放" 按钮
3. 程序自动识别相似图片
4. 按标记类型播放:
   - **循环模式**: 图片1 → 图片2 → 图片3 → 图片1 → ...
   - **顺序模式**: 图片1 → 图片2 → 图片3 → 停止

#### 播放时间设置
- 右键图片 → `⏱ 设置原图时间`
- 输入秒数（如3秒、5秒）

### 取消原图标记
- 右键图片/文件夹 → `❌ 取消原图标记`

---

## 投影功能

### 什么是投影？

投影功能将主屏幕内容实时同步到**外接显示器**（如投影仪、第二屏幕），用于：
- 🎓 课堂教学演示
- 💼 会议PPT展示
- 🎬 双屏幕演出控制

### 开启投影

#### 前提条件
- 连接第二个显示器（投影仪/外接屏幕）
- Windows显示设置设为 "扩展显示"

#### 操作步骤
1. 点击菜单栏 **"投影"** 按钮
2. 选择目标显示器（下拉框）
3. 点击 "开启投影"
4. 投影窗口会在选定的显示器上全屏打开

### 投影特性

#### 自动同步
- **图片内容**: 主屏切换图片，投影屏自动切换
- **滚动位置**: 主屏滚动，投影屏实时同步（相对位置）
- **缩放比例**: 主屏缩放，投影屏同步缩放
- **关键帧跳转**: 主屏跳转，投影屏同步跳转
- **视频播放**: 主屏播放视频，投影屏同步播放

#### 性能优化
- **共享渲染**: 主屏和投影屏复用同一个BitmapSource（零拷贝）
- **GPU加速**: WPF自动使用DirectX硬件加速
- **FPS监控**: 实时显示主屏和投影屏的帧率

### 投影控制

#### 热键支持
- 投影窗口支持所有全局热键
- 按键操作会转发到主窗口处理
- `ESC`: 先关闭投影，再次按ESC停止播放

#### 关闭投影
- 点击菜单栏 "投影" 按钮（再次点击关闭）
- 按 `ESC` 键（如果正在播放，需按两次）

---

## 视频播放

### 支持格式

- **视频**: MP4, AVI, MKV, MOV, WMV, FLV, F4V, RM, RMVB
- **音频**: MP3, WAV, FLAC, OGG, M4A, AAC

### 播放控制

#### 基本操作
- **播放/暂停**: 点击视频区域或按 `空格键`
- **停止**: 按 `ESC` 键
- **切换**: `PgUp`/`PgDown` 切换到上下文件

#### 播放位置
- **主屏幕播放**: 默认在主窗口播放
- **投影播放**: 开启投影后，视频同时在主屏和投影屏播放

#### 音频文件
- 纯音频文件会显示 🎵 图标和文件名
- 投影时在投影屏显示音频文件名（黑底白字）

### 视频投影

#### 自动切换
- 切换到视频文件时，投影窗口自动从图片模式切换到视频模式
- 切换回图片文件时，自动恢复图片模式

#### 同步播放
- 主屏和投影屏的视频进度完全同步
- 暂停/播放操作实时同步

---

## 文本幻灯片

### 什么是文本幻灯片？

文本幻灯片是**可视化文本编辑器**，用于创建简单的幻灯片项目，无需外部PPT软件。

### 创建项目

#### 步骤
1. 点击菜单栏 **"项目"** 按钮
2. 点击 "新建项目"
3. 输入项目名称
4. 点击项目名称进入编辑模式

### 编辑幻灯片

#### 新建文本框
1. 点击工具栏 "新建文本框" 按钮
2. 文本框自动创建并进入编辑模式
3. 输入文字内容

#### 文本框操作
- **移动**: 按住文本框边缘拖动
- **调整大小**: 拖动右下角手柄
- **编辑内容**: 双击文本框（或按 `Enter`/`F2`）
- **退出编辑**: 点击其他区域或按 `ESC`
- **删除**: 选中后按 `DEL` 键或右键 → 删除

#### 文本样式
- **字体**: 下拉选择（支持自定义中文字体）
- **字号**: 点击 `+` / `-` 按钮或滚轮调整（步长2）
- **颜色**: 点击颜色按钮选择
- **对齐**: 左对齐/居中/右对齐

#### 画面设置
- **背景色**: 点击 "背景色" 按钮选择
- **清空画面**: 点击 "清空" 按钮删除所有文本框

### 幻灯片分页

#### 新建幻灯片
1. 点击工具栏 "新建幻灯片" 按钮
2. 新建一页空白幻灯片

#### 删除幻灯片
1. 选中幻灯片（左侧列表）
2. 点击 "删除幻灯片" 按钮

#### 切换幻灯片
- 点击左侧幻灯片列表
- 使用 `PgUp`/`PgDown` 快速切换

### 保存和投影

#### 保存项目
- 修改后自动保存到数据库
- 退出编辑器时提示保存

#### 投影显示
- 在主窗口选中文本项目
- 开启投影后自动显示在投影屏
- 支持实时编辑，投影同步更新

### 原图标记功能

#### 画面分割
1. 点击工具栏 "分割画面" 按钮
2. 选择分割模式:
   - 1×1 (全屏单图)
   - 1×2 (横向两图)
   - 2×1 (纵向两图)
   - 2×2 (四宫格)
   - 3×1 / 3×2 / 1×3 / 2×3 (多宫格)

3. 点击分割区域加载图片
4. 支持清除图片（`DEL` 键）

#### 用途
- 对比展示（如变色前后、不同版本）
- 拼接长图

---

## 图片效果

### 变色效果

#### 功能说明
自动识别**深色背景的黄色文字**，将其反转为**白色背景的黑色文字**，提升阅读体验。

#### 适用场景
- 暗色主题的代码截图
- 黑底黄字的PPT截图
- 夜间模式的文档截图

#### 手动开启
1. 右键图片 → `🎨 开启变色效果`
2. 图片背景变为白色，文字变为黑色

#### 自动开启
1. 右键文件夹 → `🔄 自动变色`
2. 文件夹内所有图片加载时自动应用变色效果

#### 关闭变色
- 右键图片 → `❌ 关闭变色效果`
- 或右键文件夹 → `取消自动变色`

### 变色算法

程序会智能判断：
- **背景亮度** < 80 → 深色背景
- **文字亮度** > 100 → 亮色文字（如黄色、白色）
- 满足条件则反转：黑底 → 白底，黄字 → 黑字

---

## 快捷键列表

### 全局热键（后台也生效）

| 快捷键 | 功能 |
|--------|------|
| `PgUp` | 上一张图片/视频 |
| `PgDown` | 下一张图片/视频 |
| `F2` | 录制关键帧 |
| `ESC` | 停止播放/关闭投影 |

### 主窗口快捷键

| 快捷键 | 功能 |
|--------|------|
| `空格键` | 播放/暂停 |
| `Ctrl + 滚轮` | 缩放图片 |
| `Home` | 跳转到第一张 |
| `End` | 跳转到最后一张 |
| `Delete` | 删除选中项 |
| `Enter` | 进入编辑模式 |

### 文本编辑器快捷键

| 快捷键 | 功能 |
|--------|------|
| `Enter` / `F2` | 进入编辑模式 |
| `ESC` | 退出编辑模式 |
| `DEL` | 删除文本框 |
| `Ctrl + 滚轮` | 调整字号 |
| `PgUp` / `PgDown` | 切换幻灯片 |

---

## 常见问题

### 1. 投影无法打开

**问题**: 点击 "投影" 按钮提示 "未检测到第二个显示器"

**解决方案**:
1. 检查第二显示器是否正确连接
2. 进入 Windows 显示设置
3. 确保显示模式为 "扩展显示"（非"复制显示"）
4. 重启程序

### 2. 关键帧播放卡顿

**问题**: 关键帧跳转时出现卡顿或延迟

**原因**: 
- 图片过大（>8192px）
- 电脑配置较低
- 缓存未命中

**解决方案**:
1. 缩小图片尺寸（推荐≤4K分辨率）
2. 调整滚动速度（增加到10秒以上）
3. 关闭其他占用GPU的程序

### 3. 视频播放无画面

**问题**: 视频文件能播放声音，但画面黑屏

**原因**: 
- 视频编码不支持
- LibVLC组件异常

**解决方案**:
1. 转换视频为MP4格式（H.264编码）
2. 重新安装程序（重新下载LibVLC组件）
3. 检查视频文件是否损坏

### 4. 变色效果不生效

**问题**: 开启变色后图片没有变化

**原因**: 
- 图片背景不够暗（亮度≥80）
- 文字颜色不够亮（亮度≤100）

**解决方案**:
1. 检查原图背景是否为深色
2. 检查文字是否为黄色/白色
3. 手动调整图片亮度后再试

### 5. 图片缓存占用内存过大

**问题**: 程序运行时间长后内存占用超过2GB

**原因**: 
- 浏览了大量大尺寸图片
- LRU缓存未及时清理

**解决方案**:
1. 重启程序（自动清空缓存）
2. 减少缓存大小（修改Constants.cs中的缓存参数）
3. 定期清理缓存（右键 → 清理缓存）

### 6. 文本编辑器保存失败

**问题**: 编辑文本后退出，重新打开发现未保存

**原因**: 
- 数据库写入失败
- 未点击 "保存" 按钮

**解决方案**:
1. 编辑后点击 "保存项目" 按钮
2. 检查 `pyimages.db` 文件是否有写权限
3. 查看程序目录是否有足够磁盘空间

### 7. 全局热键冲突

**问题**: 按 `PgUp`/`PgDown` 无反应

**原因**: 
- 其他程序占用了全局热键
- 系统热键冲突

**解决方案**:
1. 关闭其他可能占用热键的程序
2. 重启程序重新注册热键
3. 如仍无效，使用鼠标点击操作

### 8. 投影滚动不同步

**问题**: 主屏滚动时投影屏不跟随

**原因**: 
- 滚动速度过快超过节流限制
- 投影窗口未正确初始化

**解决方案**:
1. 减慢滚动速度
2. 关闭投影重新打开
3. 检查投影窗口是否在正确的显示器上

### 9. PAK资源加载失败

**问题**: 字体/图片加载失败，提示 "资源不存在"

**原因**: 
- Resources.pak 文件缺失或损坏
- 文件路径错误

**解决方案**:
1. 重新构建项目（运行 `build.bat`）
2. 检查程序目录下是否存在 `Resources.pak`
3. 删除PAK文件，程序会自动降级到文件系统加载

### 10. 数据库迁移错误

**问题**: 启动时提示 "数据库迁移失败"

**原因**: 
- 数据库版本不兼容
- 数据库文件损坏

**解决方案**:
1. 备份 `pyimages.db` 文件
2. 删除数据库文件，重启程序（会自动创建新数据库）
3. 重新导入文件夹

---

## 高级技巧

### 1. 批量导入优化

**技巧**: 导入大量文件时，关闭预缓存功能以提升速度

**操作**:
1. 设置 → 关闭 "智能预缓存"
2. 批量导入文件夹
3. 导入完成后重新开启

### 2. 关键帧精确控制

**技巧**: 使用滚轮精确定位关键帧位置

**操作**:
1. 滚动到大致位置
2. 按住 `Shift` + 滚轮微调（每次1像素）
3. 录制关键帧

### 3. 投影性能优化

**技巧**: 调整投影分辨率以提升FPS

**操作**:
1. Windows显示设置 → 选择投影屏
2. 调整分辨率为1080P（而非4K）
3. 重新开启投影

### 4. 快速清空关键帧

**技巧**: 批量清除多张图片的关键帧

**操作**:
1. 右键文件夹 → "清除所有关键帧"
2. 文件夹内所有图片的关键帧会被批量删除

### 5. 文本幻灯片模板

**技巧**: 创建模板项目，快速复用样式

**操作**:
1. 创建一个 "模板" 项目
2. 设置好背景色、字体、字号
3. 每次新建项目时复制该项目的幻灯片

---

## 联系与支持

### 获取帮助

- **微信**: 点击菜单栏 "联系" → 扫描微信二维码
- **捐赠**: 点击菜单栏 "联系" → 扫描支付宝/微信捐赠码
- **更新日志**: 查看 `updata.txt` 文件

### 反馈问题

如果遇到BUG或有功能建议，请提供：
1. 问题描述
2. 操作步骤
3. 截图/视频
4. 系统版本和程序版本

---

**感谢使用 Canvas Cast！**  
**版本**: V5.0.9  
**更新时间**: 2025-10-22

