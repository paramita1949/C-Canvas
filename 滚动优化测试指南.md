# Canvas Cast - 滚动优化测试指南

## 🧪 测试目的
验证滚动动画优化是否达到预期效果，确保丝滑度和性能提升。

---

## 📋 测试前准备

### 1. 编译项目
```bash
# 在项目根目录执行
dotnet build --configuration Release
```

### 2. 准备测试素材
- ✅ 4K图片（3840x2160）至少3张
- ✅ 8K图片（7680x4320）至少1张（可选）
- ✅ 长图（宽度正常，高度>5000px）至少1张

### 3. 启动应用
- 运行编译后的程序
- 观察Debug输出窗口的GPU状态信息

---

## ✅ 测试项目

### 测试1: GPU加速验证

**目标**: 确认GPU硬件加速已启用

**步骤**:
1. 启动应用，查看Debug输出
2. 应该看到类似信息：
   ```
   ========================================
   🎮 SkiaSharp GPU状态: ✅ 已启用 或 ⚠️ CPU模式
   📊 SkiaSharp GPU信息: [GPU信息]
   🖥️ WPF GPU加速状态: ✅ Tier 2完全启用
   ========================================
   ✅ [滚动优化] 已为ScrollViewer和Image启用GPU位图缓存
   ```

**预期结果**:
- ✅ WPF GPU状态为 Tier 2
- ✅ 位图缓存已启用

**如果失败**:
- 检查显卡驱动是否最新
- 尝试在系统设置中启用硬件加速图形

---

### 测试2: 新缓动函数验证

**目标**: 确认新增的4种缓动函数可用

**步骤**:
1. 导入一张4K图片
2. 在图片区域右键 → 滚动函数
3. 检查菜单中是否有：
   - ⭐ 超级平滑
   - 🎯 物理模拟
   - 🌊 弹性平滑
   - 🧠 智能自适应

**预期结果**:
- ✅ 4个新选项都可见
- ✅ 每个选项都有Tooltip提示
- ✅ 可以正常选中

---

### 测试3: 超级平滑缓动体验测试 ⭐

**目标**: 对比新旧缓动函数的丝滑度

**测试A - 贝塞尔曲线（原有）**:
1. 图片区域右键 → 滚动函数 → 贝塞尔曲线
2. 点击图片底部（触发滚动）
3. 观察滚动动画的启动和结束

**测试B - 超级平滑（新增）**:
1. 图片区域右键 → 滚动函数 → ⭐ 超级平滑
2. 点击图片底部（触发滚动）
3. 观察滚动动画的启动和结束

**主观评价**:
- 启动平滑度：UltraSmooth > Bezier？
- 结束平滑度：UltraSmooth > Bezier？
- 整体感觉：UltraSmooth 更丝滑？

**预期结果**:
- ✅ UltraSmooth 启动和结束都极其平滑
- ✅ 无突变感，像"黄油般顺滑"
- ✅ 明显优于Bezier

---

### 测试4: 物理模拟缓动测试

**目标**: 验证物理模拟的自然感

**步骤**:
1. 图片区域右键 → 滚动函数 → 🎯 物理模拟
2. 点击图片底部（触发滚动）
3. 观察滚动动画是否像"真实滚动"

**预期结果**:
- ✅ 滚动有"惯性"感
- ✅ 逐渐减速，符合物理直觉
- ✅ 适合模拟触摸滚动

---

### 测试5: 弹性平滑缓动测试

**目标**: 验证轻微回弹效果

**步骤**:
1. 图片区域右键 → 滚动函数 → 🌊 弹性平滑
2. 点击图片底部（触发滚动）
3. 仔细观察到达终点时的动画

**预期结果**:
- ✅ 到达终点时有轻微"回弹"
- ✅ 回弹幅度很小（不明显）
- ✅ 增加一点趣味性

**注意**:
- 回弹可能不明显，需要仔细观察
- 如果回弹太大，说明Elasticity参数需要调整

---

### 测试6: 智能自适应测试

**目标**: 验证自动根据距离调整曲线

**测试A - 短距离（<500px）**:
1. 图片区域右键 → 滚动函数 → 🧠 智能自适应
2. 点击图片中部（短距离滚动）
3. 观察滚动速度和曲线

**测试B - 长距离（>2000px）**:
1. 保持智能自适应
2. 点击图片底部（长距离滚动）
3. 观察滚动速度和曲线

**预期结果**:
- ✅ 短距离：滚动较快，曲线较陡
- ✅ 长距离：滚动更平滑，曲线更缓
- ✅ 自动适配，体验一致

---

### 测试7: 帧率稳定性测试

**目标**: 验证60 FPS稳定性

**准备**:
- 安装帧率监控工具（如MSI Afterburner）
- 或使用Windows任务管理器 → 性能 → GPU

**步骤**:
1. 导入一张4K大图
2. 设置滚动速度为8.0秒
3. 选择 ⭐ 超级平滑缓动
4. 触发滚动，观察帧率

**预期结果**:
- ✅ 帧率稳定在59-60 FPS
- ✅ 无明显掉帧（<55 FPS）
- ✅ CPU占用 < 10%

---

### 测试8: 多次连续滚动测试

**目标**: 验证缓存和性能稳定性

**步骤**:
1. 导入一张4K大图
2. 连续点击5次底部（触发5次滚动）
3. 观察：
   - 第1次滚动性能
   - 第5次滚动性能
   - CPU和GPU占用变化

**预期结果**:
- ✅ 第1次和第5次性能一致
- ✅ 无内存泄漏（任务管理器检查）
- ✅ 缓存生效，CPU占用不增加

---

### 测试9: 超大图（8K）性能测试

**目标**: 验证大图滚动性能

**步骤**:
1. 导入一张8K图片（如果有）
2. 设置滚动速度为10.0秒
3. 选择 ⭐ 超级平滑缓动
4. 触发滚动

**预期结果**:
- ✅ 帧率 ≥ 55 FPS
- ✅ 无明显卡顿
- ✅ 滚动依然丝滑

**如果性能不佳**:
- 检查GPU占用是否过高
- 尝试降低图片质量设置

---

### 测试10: 播放模式滚动测试

**目标**: 验证关键帧播放时的滚动性能

**步骤**:
1. 导入一张长图
2. 添加3个关键帧（顶部、中部、底部）
3. 设置滚动速度为8.0秒
4. 选择 ⭐ 超级平滑缓动
5. 点击"▶ 播放"

**预期结果**:
- ✅ 自动滚动丝滑流畅
- ✅ 每次跳转都使用超级平滑缓动
- ✅ 帧率稳定60 FPS

---

## 📊 性能基准

### 优秀（⭐⭐⭐⭐⭐）
- 帧率：60 FPS（无掉帧）
- CPU占用：< 8%
- GPU占用：< 20%
- 主观感受：极致丝滑

### 良好（⭐⭐⭐⭐☆）
- 帧率：58-60 FPS（偶尔掉1-2帧）
- CPU占用：8-12%
- GPU占用：20-30%
- 主观感受：流畅舒适

### 合格（⭐⭐⭐☆☆）
- 帧率：55-58 FPS（可见掉帧）
- CPU占用：12-15%
- GPU占用：30-40%
- 主观感受：基本流畅

### 不合格（⭐⭐☆☆☆）
- 帧率：< 55 FPS（频繁掉帧）
- CPU占用：> 15%
- GPU占用：> 40%
- 主观感受：有卡顿感

---

## 🐛 常见问题排查

### 问题1: GPU未启用（Tier 0 或 Tier 1）

**症状**: Debug输出显示非Tier 2

**解决方案**:
1. 更新显卡驱动
2. 在Windows设置中启用硬件加速图形
3. 检查是否在虚拟机中运行（虚拟机通常无GPU加速）

---

### 问题2: 滚动掉帧明显

**症状**: 帧率经常低于55 FPS

**排查步骤**:
1. 检查GPU加速是否启用
2. 关闭其他占用GPU的程序
3. 降低图片质量设置
4. 尝试关闭病毒扫描软件

---

### 问题3: 新缓动函数菜单不显示

**症状**: 右键菜单中看不到新选项

**解决方案**:
1. 确认已重新编译项目
2. 检查XAML文件是否正确修改
3. 清理并重新生成（Clean → Rebuild）

---

### 问题4: 弹性缓动回弹太大

**症状**: ElasticSmooth 回弹过于明显

**解决方案**:
- 降低 Elasticity 参数（在 `AnimationHelper.cs` 中）
- 当前值：0.2（轻微）
- 建议范围：0.1-0.3

---

## ✅ 测试报告模板

```
=== 滚动优化测试报告 ===

测试日期: _______
测试人员: _______
系统环境:
- 操作系统: _______
- CPU: _______
- GPU: _______
- 内存: _______

测试结果:
[ ] 测试1: GPU加速验证 - ✅通过 / ❌失败
[ ] 测试2: 新缓动函数验证 - ✅通过 / ❌失败
[ ] 测试3: 超级平滑体验测试 - ⭐⭐⭐⭐⭐
[ ] 测试4: 物理模拟测试 - ⭐⭐⭐⭐⭐
[ ] 测试5: 弹性平滑测试 - ⭐⭐⭐⭐⭐
[ ] 测试6: 智能自适应测试 - ⭐⭐⭐⭐⭐
[ ] 测试7: 帧率稳定性测试 - _____ FPS
[ ] 测试8: 连续滚动测试 - ✅通过 / ❌失败
[ ] 测试9: 超大图性能测试 - _____ FPS
[ ] 测试10: 播放模式测试 - ✅通过 / ❌失败

性能数据:
- 平均帧率: _____ FPS
- 最低帧率: _____ FPS
- CPU占用: _____%
- GPU占用: _____%

主观评价:
- 启动平滑度: ⭐⭐⭐⭐⭐
- 结束平滑度: ⭐⭐⭐⭐⭐
- 整体丝滑度: ⭐⭐⭐⭐⭐

推荐配置:
- 滚动速度: _____ 秒
- 滚动函数: _______

总体评价: ⭐⭐⭐⭐⭐

备注:
_______________________
```

---

## 🎯 测试通过标准

**必须满足（硬性指标）**:
- ✅ GPU加速已启用（Tier 2）
- ✅ 4个新缓动函数可用
- ✅ 4K图片滚动帧率 ≥ 58 FPS
- ✅ 无明显卡顿或闪烁

**建议达到（软性指标）**:
- ✅ 主观丝滑度评价 ≥ ⭐⭐⭐⭐
- ✅ UltraSmooth 明显优于Bezier
- ✅ CPU占用 < 10%
- ✅ 连续滚动性能稳定

---

## 📞 反馈渠道

如果测试中发现问题，请记录：
1. 具体测试步骤
2. 预期结果 vs 实际结果
3. 系统环境信息
4. 截图或录屏（如果可能）

---

*测试指南版本：V1.0*  
*创建日期：2025-10-19*

