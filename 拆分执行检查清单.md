# MainWindow 拆分执行检查清单

快速参考版本 | 配合《TODO_中优先级执行计划.md》使用

---

## ✅ 阶段一：命名规范（2周）

### Week 1: 字段重命名
- [ ] **Day 1-2**: Manager类字段（11个）
  ```csharp
  ❌ private VideoPlayerManager videoPlayerManager;
  ✅ private VideoPlayerManager _videoPlayerManager;
  ```
  - [ ] _videoPlayerManager
  - [ ] _dbManager
  - [ ] _configManager
  - [ ] _importManager
  - [ ] _imageSaveManager
  - [ ] _searchManager
  - [ ] _sortManager  
  - [ ] _projectionManager
  - [ ] _originalManager
  - [ ] _preloadCacheManager
  - [ ] _globalHotKeyManager
  - [ ] 编译测试 ✓
  - [ ] 功能测试 ✓

- [ ] **Day 3-4**: 核心功能字段（15个）
  - [ ] _imageProcessor ~ _isDragInProgress
  - [ ] 编译测试 ✓
  - [ ] 功能测试 ✓

- [ ] **Day 5**: 视频和其他字段（10个）
  - [ ] _mainVideoView ~ _lastMediaNextClickTime
  - [ ] 全面测试 ✓
  - [ ] Git提交 ✓

### Week 2: 常量和异步命名
- [ ] **Day 1-2**: 提取魔法数字为常量
  ```csharp
  ❌ if (time < 300) return;
  ✅ if (time < BUTTON_DEBOUNCE_MILLISECONDS) return;
  ```
  - [ ] 创建UIConstants类
  - [ ] 提取所有魔法数字
  - [ ] 测试 ✓

- [ ] **Day 3-5**: 异步方法添加Async后缀
  - [ ] 识别所有async方法
  - [ ] 批量重命名
  - [ ] 更新XAML绑定
  - [ ] 测试 ✓
  - [ ] Git提交 ✓

---

## ✅ 阶段二：拆分MainWindow（4周）

### Week 3: 分析设计 + Media模块
- [ ] **Day 1-3**: 分析和设计
  - [ ] 分析所有方法（200+）
  - [ ] 功能模块分组
  - [ ] 创建拆分设计文档
  - [ ] 评估风险

- [ ] **Day 4-5**: MainWindow.Media.cs（第1部分）
  - [ ] 创建文件和基础结构
  - [ ] 迁移字段（5个）
  - [ ] 迁移InitializeVideoPlayer()

### Week 4: Media模块完成
- [ ] **Day 1-3**: MainWindow.Media.cs（第2部分）
  - [ ] 迁移视频事件处理（6个方法）
  - [ ] 迁移播放控制方法
  - [ ] 迁移LoadAndDisplayVideo()
  - [ ] 迁移SwitchToImageMode()

- [ ] **Day 4-5**: 测试和验证
  - [ ] 编译测试 ✓
  - [ ] 视频播放测试 ✓
  - [ ] 音频播放测试 ✓
  - [ ] 进度条测试 ✓
  - [ ] 代码审查 ✓
  - [ ] Git提交 ✓

### Week 5: Projection + TreeView模块
- [ ] **Day 1-3**: MainWindow.Projection.cs
  - [ ] 创建文件
  - [ ] 迁移投影相关代码
  - [ ] 测试投影功能 ✓
  - [ ] Git提交 ✓

- [ ] **Day 4-5**: MainWindow.TreeView.cs（第1部分）
  - [ ] 创建文件
  - [ ] 迁移项目树字段
  - [ ] 迁移LoadProject()

### Week 6: TreeView + ImageProcessing模块
- [ ] **Day 1-2**: MainWindow.TreeView.cs（第2部分）
  - [ ] 迁移TreeView事件
  - [ ] 迁移拖拽功能
  - [ ] 测试 ✓
  - [ ] Git提交 ✓

- [ ] **Day 3-5**: MainWindow.ImageProcessing.cs
  - [ ] 创建文件
  - [ ] 迁移图像处理代码
  - [ ] 测试 ✓
  - [ ] Git提交 ✓

### Week 7: EventHandlers + 最终整理
- [ ] **Day 1-3**: MainWindow.EventHandlers.cs
  - [ ] 创建文件
  - [ ] 迁移事件处理代码
  - [ ] 测试 ✓
  - [ ] Git提交 ✓

- [ ] **Day 4-5**: 重构MainWindow.Core.cs
  - [ ] 精简主文件
  - [ ] 清理重复代码
  - [ ] 优化结构
  - [ ] 全面测试 ✓
  - [ ] 最终审查 ✓
  - [ ] Git提交 ✓

---

## 📊 快速状态表

| 模块 | 目标行数 | 状态 | 测试 | 提交 |
|------|---------|------|------|------|
| 命名规范 | - | 🔲 | 🔲 | 🔲 |
| MainWindow.Media | ~600行 | 🔲 | 🔲 | 🔲 |
| MainWindow.Projection | ~400行 | 🔲 | 🔲 | 🔲 |
| MainWindow.TreeView | ~500行 | 🔲 | 🔲 | 🔲 |
| MainWindow.ImageProcessing | ~600行 | 🔲 | 🔲 | 🔲 |
| MainWindow.EventHandlers | ~500行 | 🔲 | 🔲 | 🔲 |
| MainWindow.Core (精简后) | <1000行 | 🔲 | 🔲 | 🔲 |

**当前MainWindow**: 6003行 → **目标**: <1000行

---

## 🧪 每日测试检查项

### 编译测试
```bash
dotnet build --configuration Debug
# 预期: 0 errors
```

### 功能测试（5分钟快速测试）
- [ ] 启动应用
- [ ] 加载项目
- [ ] 切换图片
- [ ] 播放视频
- [ ] 测试热键（ESC, F2, 方向键）
- [ ] 关闭应用

### 深度测试（每周五）
- [ ] 完整工作流测试
- [ ] 性能测试
- [ ] 内存泄漏检查

---

## 🚨 遇到问题时

### 快速诊断
1. **编译错误**: 检查字段/方法是否正确迁移
2. **功能异常**: 回滚到上一个Git标签
3. **性能问题**: 对比拆分前后性能数据

### 回滚命令
```bash
# 查看标签
git tag -l

# 回滚到指定标签
git reset --hard <tag-name>
```

---

## 📌 每日工作流程

### 开始工作
1. 查看TODO_中优先级执行计划.md
2. 选择今天的任务
3. 创建或切换到对应分支

### 工作中
4. 按检查清单执行
5. 每小时保存工作进度
6. 遇到问题记录Issue

### 结束工作
7. 运行编译测试
8. 运行功能测试
9. 更新进度
10. Git提交

---

## ✨ 完成标准

### 阶段一完成标准
- ✅ 所有字段使用下划线前缀
- ✅ 无魔法数字
- ✅ 异步方法有Async后缀
- ✅ 编译无错误
- ✅ 所有功能正常

### 阶段二完成标准
- ✅ MainWindow.xaml.cs < 1000行
- ✅ 每个部分类职责清晰
- ✅ 无重复代码
- ✅ 编译无错误
- ✅ 完整回归测试通过
- ✅ 性能无明显下降
- ✅ 代码审查通过

---

**使用提示**：
- 打印此文档，每天勾选完成的项目
- 配合详细的TODO文档使用
- 遇到问题随时标记和记录

**更新日期**: 2025-10-17

